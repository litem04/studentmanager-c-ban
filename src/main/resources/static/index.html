<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Management</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #333; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background: #f4f4f4; }
        input, button { padding: 6px; margin: 4px; }
        .search-box { margin-top: 20px; }
        .btn-delete { background: red; color: white; border: none; padding: 4px 8px; cursor: pointer; }
        .btn-delete:hover { background: darkred; }
    </style>
</head>
<body>
    <h1>Student Management</h1>

    <!-- Form thêm học sinh -->
    <div>
        <input type="text" id="name" placeholder="Name">
        <input type="number" id="age" placeholder="Age">
        <input type="email" id="email" placeholder="Email">
        <button onclick="addStudent()">Add Student</button>
    </div>

    <!-- Tìm kiếm -->
    <div class="search-box">
        <input type="number" id="searchId" placeholder="Enter Student ID">
        <button onclick="searchStudent()">Search</button>
        <button onclick="loadStudents()">Show All</button>
    </div>

    <!-- Danh sách -->
    <h2>Student List</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th><th>Name</th><th>Age</th><th>Email</th><th>Action</th>
            </tr>
        </thead>
        <tbody id="studentTable"></tbody>
    </table>

    <script>
        const apiBase = "http://localhost:8080/api/students";

        // Load toàn bộ sinh viên
        function loadStudents() {
            fetch(apiBase)
                .then(res => res.json())
                .then(data => {
                    let tbody = document.getElementById("studentTable");
                    tbody.innerHTML = "";
                    data.forEach(st => {
                        tbody.innerHTML += `
                            <tr>
                                <td>${st.id}</td>
                                <td>${st.name}</td>
                                <td>${st.age}</td>
                                <td>${st.eEmail}</td>
                                <td><button class="btn-delete" onclick="deleteStudent(${st.id})">Delete</button></td>
                            </tr>`;
                    });
                })
                .catch(err => console.error("Error loading students:", err));
        }

        // Thêm sinh viên
        function addStudent() {
            const name = document.getElementById("name").value;
            const age = document.getElementById("age").value;
            const eEmail = document.getElementById("email").value;

            fetch(apiBase, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, age, eEmail })
            })
            .then(res => {
                if (!res.ok) throw new Error("Error adding student");
                return res.json();
            })
            .then(() => {
                alert("Student added successfully!");
                loadStudents();
            })
            .catch(err => alert(err.message));
        }

        // Xóa sinh viên
        function deleteStudent(id) {
            if (!confirm("Are you sure you want to delete this student?")) return;

            fetch(`${apiBase}/${id}`, { method: "DELETE" })
                .then(res => {
                    if (res.ok) {
                        alert("Deleted successfully!");
                        loadStudents();
                    } else {
                        alert("Error deleting student!");
                    }
                })
                .catch(err => alert(err.message));
        }

        // Tìm theo ID
        function searchStudent() {
            const id = document.getElementById("searchId").value;
            if (!id) { alert("Please enter student ID!"); return; }

            fetch(`${apiBase}/${id}`)
                .then(res => {
                    if (!res.ok) throw new Error("Student not found!");
                    return res.json();
                })
                .then(st => {
                    let tbody = document.getElementById("studentTable");
                    tbody.innerHTML = `
                        <tr>
                            <td>${st.id}</td>
                            <td>${st.name}</td>
                            <td>${st.age}</td>
                            <td>${st.eEmail}</td>
                            <td><button class="btn-delete" onclick="deleteStudent(${st.id})">Delete</button></td>
                        </tr>`;
                })
                .catch(err => alert(err.message));
        }

        window.onload = loadStudents;
    </script>
</body>
</html>
